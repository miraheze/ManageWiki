{"version":3,"sources":["../../src/rules/requireYields.js"],"names":["canSkip","utils","hasATag","avoidDocs","checkTagName","report","tagName","preferredTagName","getPreferredTagName","tags","getTags","length","tag","missingTag","context","next","nextWithGeneratorTag","forceRequireNext","forceRequireYields","withGeneratorTag","options","iteratingFunction","isIteratingFunction","preferredYieldTagName","missingYieldTag","shouldReportYields","hasTag","isGenerator","hasYieldValue","preferredNextTagName","missingNextTag","shouldReportNext","hasYieldReturnValue","contextDefaults","meta","docs","description","url","schema","additionalProperties","properties","contexts","items","type","exemptedBy","default"],"mappings":"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","sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\n/**\n * We can skip checking for a yield value, in case the documentation is inherited\n * or the method has a constructor or abstract tag.\n *\n * In either of these cases the yield value is optional or not defined.\n *\n * @param {*} utils\n *   a reference to the utils which are used to probe if a tag is present or not.\n * @returns {boolean}\n *   true in case deep checking can be skipped; otherwise false.\n */\nconst canSkip = (utils) => {\n  return utils.hasATag([\n    // inheritdoc implies that all documentation is inherited\n    // see https://jsdoc.app/tags-inheritdoc.html\n    //\n    // Abstract methods are by definition incomplete,\n    // so it is not an error if it declares a yield value but does not implement it.\n    'abstract',\n    'virtual',\n\n    // Constructors do not have a yield value\n    // so we can bail out here, too.\n    'class',\n    'constructor',\n\n    // Yield (and any `next`) type is specified accompanying the targeted\n    //   @type\n    'type',\n\n    // This seems to imply a class as well\n    'interface',\n  ]) ||\n    utils.avoidDocs();\n};\n\nconst checkTagName = (utils, report, tagName) => {\n  const preferredTagName = utils.getPreferredTagName({tagName});\n  if (!preferredTagName) {\n    return [];\n  }\n\n  const tags = utils.getTags(preferredTagName);\n\n  if (tags.length > 1) {\n    report(`Found more than one @${preferredTagName} declaration.`);\n  }\n\n  // In case the code yields something, we expect a yields value in JSDoc.\n  const [tag] = tags;\n  const missingTag = typeof tag === 'undefined' || tag === null;\n\n  return [preferredTagName, missingTag];\n};\n\nexport default iterateJsdoc(({\n  report,\n  utils,\n  context,\n}) => {\n  const {\n    next = false,\n    nextWithGeneratorTag = false,\n    forceRequireNext = false,\n    forceRequireYields = false,\n    withGeneratorTag = true,\n  } = context.options[0] || {};\n\n  // A preflight check. We do not need to run a deep check\n  // in case the @yield comment is optional or undefined.\n  if (canSkip(utils)) {\n    return;\n  }\n\n  const iteratingFunction = utils.isIteratingFunction();\n\n  const [preferredYieldTagName, missingYieldTag] = checkTagName(\n    utils, report, 'yields',\n  );\n  if (preferredYieldTagName) {\n    const shouldReportYields = () => {\n      if (!missingYieldTag) {\n        return false;\n      }\n\n      if (\n        withGeneratorTag && utils.hasTag('generator') ||\n        forceRequireYields && iteratingFunction && utils.isGenerator()\n      ) {\n        return true;\n      }\n\n      return iteratingFunction && utils.isGenerator() && utils.hasYieldValue();\n    };\n\n    if (shouldReportYields()) {\n      report(`Missing JSDoc @${preferredYieldTagName} declaration.`);\n    }\n  }\n\n  if (next || nextWithGeneratorTag || forceRequireNext) {\n    const [preferredNextTagName, missingNextTag] = checkTagName(\n      utils, report, 'next',\n    );\n    if (!preferredNextTagName) {\n      return;\n    }\n\n    const shouldReportNext = () => {\n      if (!missingNextTag) {\n        return false;\n      }\n\n      if (\n        nextWithGeneratorTag && utils.hasTag('generator')) {\n        return true;\n      }\n\n      if (\n        !next && !forceRequireNext ||\n        !iteratingFunction ||\n        !utils.isGenerator()\n      ) {\n        return false;\n      }\n\n      return forceRequireNext || utils.hasYieldReturnValue();\n    };\n\n    if (shouldReportNext()) {\n      report(`Missing JSDoc @${preferredNextTagName} declaration.`);\n    }\n  }\n}, {\n  contextDefaults: true,\n  meta: {\n    docs: {\n      description: 'Requires yields are documented.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-require-yields',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          exemptedBy: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          forceRequireNext: {\n            default: false,\n            type: 'boolean',\n          },\n          forceRequireYields: {\n            default: false,\n            type: 'boolean',\n          },\n          next: {\n            default: false,\n            type: 'boolean',\n          },\n          nextWithGeneratorTag: {\n            default: false,\n            type: 'boolean',\n          },\n          withGeneratorTag: {\n            default: true,\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"file":"requireYields.js"}